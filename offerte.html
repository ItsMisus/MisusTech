<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offerte - MISUSTECH</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500&display=swap" rel="stylesheet">
</head>
<body>

    <!-- Main -->
    <main>
        <h1 class="page-title">ðŸ”¥ Offerte Speciali</h1>
        <p style="text-align:center; color:#ccc; font-size:1.2rem; margin-bottom:30px;">Approfitta dei nostri sconti esclusivi sui migliori PC gaming!</p>
        
        <div class="products" id="productsContainer">
            <!-- Prodotti in offerta caricati dinamicamente -->
        </div>
        
        <!-- Paginazione -->
        <div class="pagination"></div>
        
        <!-- Bottone PC Custom -->
        <div class="custom-pc-container">
            <h2>Personalizza il tuo Affare</h2>
            <p>Vuoi una configurazione in sconto? Costruisci il tuo PC custom e richiedi il nostro miglior prezzo!</p>
            <a href="custom-pc.html" class="custom-pc-btn">ðŸŽ® Crea PC Personalizzato</a>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Chi Siamo</h3>
                <ul>
                    <li><a href="chisiamo.html">La nostra storia</a></li>
                    <li><a href="contattaci.html">Contattaci</a></li>
                    <li><a href="discord.html">Community Discord</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Informazioni Legali</h3>
                <p><strong>MISUSTECH s.r.l.</strong></p>
                <p>Partita IVA: <strong>IT01234567890</strong></p>
                <p>Via Roma 123, 76121<br>Barletta (BA) - Italia</p>
                <p><strong>Telefono:</strong> 377 590 0298<br><strong>Email:</strong> francesco.minutiello08@gmail.com</p>
            </div>

            <div class="footer-section">
                <h3>Supporto</h3>
                <ul>
                    <li><a href="contattaci.html">Contatti</a></li>
                    <li><a href="custom-pc.html">Crea PC Custom</a></li>
                    <li><a href="pcgaming.html">Catalogo Completo</a></li>
                </ul>
            </div>
        </div>

        <p>Â© 2025 MISUSTECH | Tutti i diritti riservati</p>
    </footer>

    <!-- Script -->
    <script src="script.js"></script>
    <script>
        // Carica solo prodotti in offerta
        document.addEventListener('DOMContentLoaded', () => {
            const productsContainer = document.getElementById('productsContainer');
            if(!productsContainer) return;

            const PRODUCTS_PER_PAGE = 12;
            let allProducts = [];
            let currentPage = 1;
            let filteredProducts = [];

            fetch('products.json')
                .then(res => res.json())
                .then(products => {
                    allProducts = products.filter(p => p.discount);
                    filteredProducts = allProducts;
                    
                    if(filteredProducts.length === 0) {
                        productsContainer.innerHTML = '<p style="text-align:center; color:#aaa; grid-column:1/-1; font-size:1.2rem; margin:50px 0;">Nessuna offerta disponibile al momento. Torna presto!</p>';
                        return;
                    }
                    
                    displayPage(1);
                    setupPagination();
                })
                .catch(err => console.error('Errore caricamento prodotti:', err));

            function displayProducts(products) {
                productsContainer.innerHTML = '';
                
                products.forEach(prod => {
                    const div = document.createElement('div');
                    div.className = 'product discount';
                    div.dataset.name = prod.name;
                    div.dataset.price = prod.discountPrice;
                    div.dataset.desc = prod.desc;
                    div.dataset.img = prod.img;

                    div.innerHTML = `
                        <img src="${prod.img}" alt="${prod.name}">
                        <h3>${prod.name}</h3>
                        <p>${prod.desc}</p>
                        <p>
                            <span class="original-price">â‚¬ ${prod.price.toFixed(2)}</span>
                            <span style="color:#9b59b6; font-weight:700; margin:10px 0;">â‚¬ ${prod.discountPrice.toFixed(2)}</span>
                        </p>
                        <button class="add-to-cart">Aggiungi al carrello</button>
                    `;

                    div.addEventListener('click', e => {
                        if(!e.target.classList.contains('add-to-cart')){
                            window.location.href = `product.html?name=${encodeURIComponent(prod.name)}`;
                        }
                    });

                    productsContainer.appendChild(div);
                });

                const addButtons = document.querySelectorAll('.add-to-cart');
                addButtons.forEach(btn => {
                    btn.addEventListener('click', e => {
                        e.stopPropagation();
                        const productEl = btn.closest('.product');
                        if(!productEl) return;

                        const name = productEl.dataset.name;
                        const price = parseFloat(productEl.dataset.price);
                        const img = productEl.dataset.img;
                        const desc = productEl.dataset.desc;

                        if(typeof cartObj !== 'undefined') {
                            const existing = cartObj.cart.find(p => p.name === name);
                            if(existing) {
                                existing.qty += 1;
                            } else {
                                cartObj.cart.push({name, desc, price, img, qty: 1});
                            }
                            
                            cartObj.updateCart();
                            
                            const cartSidebar = document.getElementById('cartSidebar');
                            if(cartSidebar) {
                                cartSidebar.classList.add('active');
                            }
                            
                            btn.textContent = 'âœ“ Aggiunto';
                            btn.style.background = '#27ae60';
                            setTimeout(() => {
                                btn.textContent = 'Aggiungi al carrello';
                                btn.style.background = '';
                            }, 1500);
                        }
                    });
                });
            }

            function displayPage(pageNum) {
                const start = (pageNum - 1) * PRODUCTS_PER_PAGE;
                const end = start + PRODUCTS_PER_PAGE;
                const pageProducts = filteredProducts.slice(start, end);
                
                displayProducts(pageProducts);
                currentPage = pageNum;
            }

            function setupPagination() {
                const totalPages = Math.ceil(filteredProducts.length / PRODUCTS_PER_PAGE);
                
                let paginationDiv = document.querySelector('.pagination');
                if(!paginationDiv) {
                    paginationDiv = document.createElement('div');
                    paginationDiv.className = 'pagination';
                    productsContainer.parentElement.appendChild(paginationDiv);
                }

                paginationDiv.innerHTML = '';

                if(totalPages <= 1) return;

                if(currentPage > 1) {
                    const prevBtn = document.createElement('button');
                    prevBtn.className = 'pagination-btn prev-btn';
                    prevBtn.innerHTML = 'â† Indietro';
                    prevBtn.addEventListener('click', () => {
                        displayPage(currentPage - 1);
                        window.scrollTo({top: 0, behavior: 'smooth'});
                    });
                    paginationDiv.appendChild(prevBtn);
                }

                const pageInfo = document.createElement('span');
                pageInfo.className = 'page-info';
                pageInfo.textContent = `Pagina ${currentPage} di ${totalPages}`;
                paginationDiv.appendChild(pageInfo);

                if(currentPage < totalPages) {
                    const nextBtn = document.createElement('button');
                    nextBtn.className = 'pagination-btn next-btn';
                    nextBtn.innerHTML = 'Avanti â†’';
                    nextBtn.addEventListener('click', () => {
                        displayPage(currentPage + 1);
                        window.scrollTo({top: 0, behavior: 'smooth'});
                    });
                    paginationDiv.appendChild(nextBtn);
                }
            }
        });
    </script>
<script src="languages.js"></script>
<script src="components.js"></script>
</body>
</html>