<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offerte - MISUSTECH</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500&display=swap" rel="stylesheet">
</head>
<body>

    <!-- Header -->
    <header class="header-container">
        <div class="logo" onclick="window.location.href='index.html'">MISUSTECH</div>
        <div class="search-language-cart">
            <form id="searchForm">
                <input type="text" placeholder="Cerca un PC" name="search">
            </form>
            <select id="languageDropdown">
                <option value="it">Italiano</option>
                <option value="en">English</option>
            </select>
            <button id="accountBtn" title="Account">ðŸ‘¤</button>
            <button id="cartBtn" title="Carrello">ðŸ›’</button>
        </div>
    </header>

    <!-- Categories -->
    <nav class="categories">
        <ul>
            <li><a href="pcgaming.html">Pc Gaming</a></li>
            <li><a href="offerte.html">Offerte</a></li>
            <li><a href="chisiamo.html">Chi siamo</a></li>
            <li><a href="discord.html">Discord</a></li>
        </ul>
    </nav>

    <!-- Main -->
    <main>
        <h1 class="page-title">ðŸ”¥ Offerte Speciali</h1>
        <p style="text-align:center; color:#ccc; font-size:1.2rem; margin-bottom:30px;">Approfitta dei nostri sconti esclusivi sui migliori PC gaming!</p>
        
        <div class="products" id="productsContainer">
            <!-- Prodotti in offerta caricati dinamicamente -->
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <p>Â© 2025 MISUSTECH | Condizioni e Servizi</p>
    </footer>

    <!-- Script -->
    <script src="script.js"></script>
    <script>
        // Carica solo prodotti in offerta
        document.addEventListener('DOMContentLoaded', () => {
            const productsContainer = document.getElementById('productsContainer');
            if(!productsContainer) return;

            fetch('products.json')
                .then(res => res.json())
                .then(products => {
                    const discountProducts = products.filter(p => p.discount);
                    
                    if(discountProducts.length === 0) {
                        productsContainer.innerHTML = '<p style="text-align:center; color:#aaa; grid-column:1/-1; font-size:1.2rem; margin:50px 0;">Nessuna offerta disponibile al momento. Torna presto!</p>';
                        return;
                    }
                    
                    discountProducts.forEach(prod => {
                        const div = document.createElement('div');
                        div.className = 'product discount';
                        div.dataset.name = prod.name;
                        div.dataset.price = prod.discountPrice;
                        div.dataset.desc = prod.desc;
                        div.dataset.img = prod.img;

                        div.innerHTML = `
                            <img src="${prod.img}" alt="${prod.name}">
                            <h3>${prod.name}</h3>
                            <p>${prod.desc}</p>
                            <p>
                                <span class="original-price">â‚¬ ${prod.price.toFixed(2)}</span>
                                <span style="color:#9b59b6; font-weight:700; margin:10px 0;">â‚¬ ${prod.discountPrice.toFixed(2)}</span>
                            </p>
                            <button class="add-to-cart">Aggiungi al carrello</button>
                        `;

                        div.addEventListener('click', e => {
                            if(!e.target.classList.contains('add-to-cart')){
                                window.location.href = `product.html?name=${encodeURIComponent(prod.name)}`;
                            }
                        });

                        productsContainer.appendChild(div);
                    });

                    // Bottoni add to cart
                    const addButtons = document.querySelectorAll('.add-to-cart');
                    addButtons.forEach(btn => {
                        btn.addEventListener('click', e => {
                            e.stopPropagation();
                            const productEl = btn.closest('.product');
                            if(!productEl) return;

                            const name = productEl.dataset.name;
                            const price = parseFloat(productEl.dataset.price);
                            const img = productEl.dataset.img;
                            const desc = productEl.dataset.desc;

                            if(typeof cartObj !== 'undefined') {
                                const existing = cartObj.cart.find(p => p.name === name);
                                if(existing) {
                                    existing.qty += 1;
                                } else {
                                    cartObj.cart.push({name, desc, price, img, qty: 1});
                                }
                                
                                cartObj.updateCart();
                                
                                const cartSidebar = document.getElementById('cartSidebar');
                                if(cartSidebar) {
                                    cartSidebar.classList.add('active');
                                }
                                
                                btn.textContent = 'âœ“ Aggiunto';
                                btn.style.background = '#27ae60';
                                setTimeout(() => {
                                    btn.textContent = 'Aggiungi al carrello';
                                    btn.style.background = '';
                                }, 1500);
                            }
                        });
                    });
                })
                .catch(err => console.error('Errore caricamento prodotti:', err));
        });
    </script>

</body>
</html>